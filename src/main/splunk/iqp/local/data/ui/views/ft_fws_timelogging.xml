<form script="tabs/js/tabs.js,fws_timelogging/js/drilldownAction.js,gantt:autodiscover.js" stylesheet="tabs/css/tabs.css, RDS_TA_html2pdf:html2pdf.css">
  <init>
    <set token="tok_ResultName_tab"></set>
    <set token="tok_clk_shortVIN">*</set>
    
    <set token="i18n_FGNR" i18ntag="">FGNR</set>
    <set token="i18n_wheelAlignmentCode" i18ntag="">Spurcode</set>
    <set token="i18n_testStand" i18ntag="">Pruefstand</set>
    <set token="i18n_anz_fahrzeuge" i18ntag="">Anzahl Fahrzeuge</set>
    <set token="i18n_overall_checktime" i18ntag="">Gesamt-Pruefzeit</set>
    <set token="i18n_ausfuehrung_in_sek" i18ntag="">Ausfuehrungsdauer in Sekunden</set>
    <set token="i18n_FGNR_reset">FGNR zuruecksetzen</set>
    <set token="i18n_FGNR_eval">FGNR-Auswertung</set>
    <set token="i18n_rn_eval">ResultName-Auswertung</set>
  </init>
  <label>FT FWS: TimeLogging</label>
  <search id="filter_root">
    <query>| tstats 
  count
  from datamodel=APDM_FWS.Achse
  where (nodename=Achse) $tok_werk$ Achse.sequenceNrResult&gt;0 
  groupby Achse.shortVIN Achse.minValueDbl Achse.maxValueDbl Achse.testStand Achse.resultName Achse.wheelAlignmentCode Achse.saCode
| rename
  Achse.minValueDbl AS minValueDbl
  Achse.maxValueDbl AS maxValueDbl
| fields - count 
| stats 
    min(minValueDbl) as minStartTime
    max(maxValueDbl) as maxEndTime 
    values(Achse.resultName) as Achse.resultName
    values(Achse.saCode) as Achse.saCode
  by Achse.shortVIN Achse.wheelAlignmentCode Achse.testStand
| lookup lkup_spurcode Spurcode AS Achse.wheelAlignmentCode OUTPUT Beschreibung AS spurcode 
| eval overall_checktime=maxEndTime-minStartTime, " "=spurcode, spurcodeLang=Achse.wheelAlignmentCode + " (" + spurcode + ")"
| fields - minStartTime maxEndTime
    </query>
    <earliest>$dateTime.earliest$</earliest>
    <latest>$dateTime.latest$</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <search id="gantt_root">
    <query>| tstats
    count
  from datamodel=APDM_FWS.Achse
  where $tok_werk$ Achse.$tok_wheelAlignmentCode$ Achse.sequenceNrResult&gt;0 Achse.shortVIN="$tok_shortVIN$" Achse.$tok_testStand$ $tok_FGNR_tab$
  groupby _time Achse.wheelAlignmentCode Achse.saCode Achse.testStepResultUnit Achse.sequenceNrResult Achse.resultName Achse.testStepResult Achse.retryCount Achse.shortVIN Achse.minValueDbl Achse.maxValueDbl
| rename
  Achse.shortVIN AS shortVIN
  Achse.wheelAlignmentCode AS wheelAlignmentCode
  Achse.saCode AS saCode
  Achse.testStepResultUnit AS testStepResultUnit
  Achse.sequenceNrResult AS sequenceNrResult
  Achse.resultName AS resultName
  Achse.testStepResult AS testStepResult
  Achse.retryCount AS retryCount
  Achse.minValueDbl AS minValueDbl 
  Achse.maxValueDbl AS maxValueDbl 
| dedup sequenceNrResult
| eval 
  startTime=strftime(_time+if(testStepResultUnit="Sec" OR testStepResultUnit="Sekunden", minValueDbl, 0), "%Y-%m-%d %H:%M:%S.%3N"), 
  endTime=strftime(_time+if(testStepResultUnit="Sec" OR testStepResultUnit="Sekunden", maxValueDbl, 0), "%Y-%m-%d %H:%M:%S.%3N"),
  sequenceNrResult=case(sequenceNrResult&lt;10, toString("00" + sequenceNrResult), sequenceNrResult&lt;100, toString("0" + sequenceNrResult), true(), toString(sequenceNrResult)),
  sequenceNrResult=sequenceNrResult + ": " + resultName
| fields shortVIN retryCount sequenceNrResult testStepResult resultName startTime endTime 
| sort sequenceNrResult
    </query>
    <earliest>$dateTime.earliest$</earliest>
    <latest>$dateTime.latest$</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <search id="resultName_root">
    <query>| tstats 
    count
  from datamodel=APDM_FWS.Achse
  where (nodename=Achse) $tok_werk$ Achse.sequenceNrResult&gt;0 $tok_mv_shortVIN$ $tok_mv_testStand$ $tok_mv_saCode$ $tok_mv_wheelAlignmentCode$ Achse.resultName=$tok_resultName$ $tok_ResultName_tab$ 
  groupby Achse.shortVIN Achse.resultValueDbl
| rename 
  Achse.shortVIN AS shortVIN
  Achse.resultValueDbl AS resultValueDbl
| table shortVIN resultValueDbl
| sort _time | fields - _time </query>
    <earliest>$dateTime.earliest$</earliest>
    <latest>$dateTime.latest$</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <fieldset submitButton="false" autoRun="false">
    <input type="time" token="dateTime">
      <label>Zeit</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input id="input_werk" type="dropdown" token="tok_werk">
      <label>Werk</label>
      <prefix>Achse.werk="</prefix>
      <suffix>"</suffix>
    </input>
  </fieldset>
  <row id="tabs">
    <panel>
      <html>
        <ul id="tabs" class="nav nav-tabs">
          <li class="active">
            <a id="tab1" href="#" class="toggle-tab" data-toggle="tab" data-elements="ResultName_Filter,ResultName_Dauer,ResultName_Histo" data-token="tok_ResultName_tab">$i18n_rn_eval$</a>
          </li>
          <li>
            <a id="tab2" href="#" class="toggle-tab" data-toggle="tab" data-elements="FGNR_Filter,FGNR_Gantt" data-token="tok_FGNR_tab">$i18n_FGNR_eval$</a>
          </li>
        </ul>
      </html>
    </panel>
  </row>
  <row id="FGNR_Filter">
    <panel>
      <input id="tsInput" type="dropdown" token="tok_testStand">
        <label>Pruefstand</label>
        <choice value="*">Alle</choice>
        <search base="filter_root">
          <query>rename Achse.testStand AS testStand | fields testStand | dedup testStand | sort testStand</query>
        </search>
        <default>*</default>
        <prefix>testStand="</prefix>
        <suffix>"</suffix>
        <fieldForLabel>testStand</fieldForLabel>
        <fieldForValue>testStand</fieldForValue>
      </input>
      <input id="wacInput" type="dropdown" token="tok_wheelAlignmentCode">
        <label>Spurcode</label>
        <choice value="*">Alle</choice>
        <search base="filter_root">
          <query>rename Achse.wheelAlignmentCode AS wheelAlignmentCode | fields wheelAlignmentCode spurcodeLang | dedup wheelAlignmentCode | sort wheelAlignmentCode</query>
        </search>
        <default>*</default>
        <prefix>wheelAlignmentCode="*</prefix>
        <suffix>*"</suffix>
        <fieldForLabel>spurcodeLang</fieldForLabel>
        <fieldForValue>wheelAlignmentCode</fieldForValue>
      </input>
      <table id="vinTable">
        <search base="filter_root">
          <query>rename Achse.shortVIN AS shortVIN Achse.wheelAlignmentCode AS wheelAlignmentCode Achse.testStand AS testStand
| search $tok_testStand$ $tok_wheelAlignmentCode$ 
| table shortVIN wheelAlignmentCode " " testStand overall_checktime
| dedup shortVIN
| rename 
shortVIN AS "$i18n_FGNR$"
wheelAlignmentCode AS "$i18n_wheelAlignmentCode$"
testStand AS "$i18n_testStand$"
overall_checktime AS "$i18n_overall_checktime$"</query>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="$i18n_overall_checktime$">
          <colorPalette type="minMidMax" maxColor="#D93F3C" midColor="#FFFFFF" minColor="#65A637"></colorPalette>
          <scale type="minMidMax" midType="percentile" midValue="50"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row id="FGNR_Gantt">
    <panel>
      <title>Zeitverlauf</title>
      <input id="vinInput" type="dropdown" token="tok_shortVIN">
        <label>FGNR</label>
        <search base="filter_root">
          <query>rename Achse.shortVIN AS shortVIN | fields shortVIN | dedup shortVIN | sort shortVIN</query>
        </search>
        <prefix/>
        <suffix/>
        <fieldForLabel>shortVIN</fieldForLabel>
        <fieldForValue>shortVIN</fieldForValue>
      </input>
      <html>
        <div id="demo-view" class="splunk-view" data-require="app/gantt/components/gantt/gantt" data-options="{         &quot;managerid&quot;: &quot;gantt_root&quot;,         &quot;startField&quot;: &quot;startTime&quot;,         &quot;endField&quot;: &quot;endTime&quot;,         &quot;categoryLabel&quot;: &quot;&quot;,          &quot;categoryField&quot;: &quot;sequenceNrResult&quot;,         &quot;seriesField&quot;: &quot;shortVIN&quot;,                               &quot;timeAxisMode&quot;: &quot;DATA_RANGE&quot;,                               &quot;tokenName&quot;: &quot;gclick&quot;,                               &quot;tokenField&quot;: &quot;user&quot;}">
        </div>
      </html>
    </panel>
  </row>
  <row id="ResultName_Filter">
    <panel>
      <input id="vinMvInput" type="multiselect" token="tok_mv_shortVIN">
        <label>FGNR</label>
        <search base="filter_root">
          <query>search $tok_mv_testStand$ $tok_mv_wheelAlignmentCode$ | rename Achse.shortVIN AS shortVIN | fields shortVIN | dedup shortVIN | sort shortVIN</query>
        </search>
        <prefix>(</prefix>
        <suffix>)</suffix>
        <valuePrefix>Achse.shortVIN="</valuePrefix>
        <valueSuffix>"</valueSuffix>
        <delimiter> OR </delimiter>
        <fieldForLabel>shortVIN</fieldForLabel>
        <fieldForValue>shortVIN</fieldForValue>
        <choice value="*">Alle</choice>
        <default>*</default>
      </input>
      <input id="tsIMvnput" type="multiselect" token="tok_mv_testStand">
        <label>Teststand</label>
        <choice value="*">Alle</choice>
        <search base="filter_root">
          <query>search $tok_mv_shortVIN$ $tok_mv_wheelAlignmentCode$ $tok_mv_saCode$ | rename Achse.testStand AS testStand | fields testStand | dedup testStand | sort testStand</query>
        </search>
        <default>*</default>
        <prefix>(</prefix>
        <suffix>)</suffix>
        <valuePrefix>Achse.testStand="</valuePrefix>
        <valueSuffix>"</valueSuffix>
        <delimiter> OR </delimiter>
        <fieldForLabel>testStand</fieldForLabel>
        <fieldForValue>testStand</fieldForValue>
      </input>
      <input id="wacMvInput" type="multiselect" token="tok_mv_wheelAlignmentCode">
        <label>Spurcode</label>
        <choice value="*">Alle</choice>
        <search base="filter_root">
          <query>search $tok_mv_shortVIN$ $tok_mv_testStand$ $tok_mv_saCode$ | rename Achse.wheelAlignmentCode AS wheelAlignmentCode | fields wheelAlignmentCode spurcodeLang | dedup wheelAlignmentCode | sort wheelAlignmentCode</query>
        </search>
        <default>*</default>
        <prefix>(</prefix>
        <suffix>)</suffix>
        <valuePrefix>Achse.wheelAlignmentCode="*</valuePrefix>
        <valueSuffix>*"</valueSuffix>
        <delimiter> OR </delimiter>
        <fieldForLabel>spurcodeLang</fieldForLabel>
        <fieldForValue>wheelAlignmentCode</fieldForValue>
      </input>
      <input id="sacMvInput" type="multiselect" token="tok_mv_saCode">
        <label>SA/LA</label>
        <choice value="*">Alle</choice>
        <search base="filter_root">
          <query>search $tok_mv_shortVIN$ $tok_mv_testStand$ $tok_mv_wheelAlignmentCode$ | rename Achse.saCode AS saCode | fields saCode | mvexpand saCode | dedup saCode | sort saCode</query>
        </search>
        <default>*</default>
        <prefix>(</prefix>
        <suffix>)</suffix>
        <valuePrefix>Achse.saCode="*</valuePrefix>
        <valueSuffix>*"</valueSuffix>
        <delimiter>OR </delimiter>
        <fieldForLabel>saCode</fieldForLabel>
        <fieldForValue>saCode</fieldForValue>
      </input>
      <input id="rnInput" type="dropdown" token="tok_resultName">
        <label>ResultName</label>
        <search base="filter_root">
          <query>search $tok_mv_shortVIN$ $tok_mv_testStand$ $tok_mv_wheelAlignmentCode$ $tok_mv_saCode$ | rename Achse.resultName AS resultName | fields resultName | mvexpand resultName | dedup resultName | sort resultName</query>
        </search>
        <prefix>"</prefix>
        <suffix>"</suffix>
        <fieldForLabel>resultName</fieldForLabel>
        <fieldForValue>resultName</fieldForValue>
      </input>
    </panel>
  </row>
  <row id="ResultName_Histo">
    <panel>
      <chart>
        <search base="resultName_root">
          <query>eval _shortVIN=" shortVIN=\""+shortVIN + "\"" | bucket resultValueDbl 
| stats count(shortVIN) as "$i18n_anz_fahrzeuge$" values(_shortVIN) as shortVINs by resultValueDbl 
| eval shortVINs="(" + mvjoin(shortVINs, " OR ") + ")" 
| rename resultValueDbl AS "$i18n_ausfuehrung_in_sek$"</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">none</option>
        <drilldown>
          <set token="tok_clk_shortVIN">$row.shortVINs$</set>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row id="ResultName_Dauer">
    <panel>
      <chart id="vinChart">
        <search base="resultName_root">
          <query>search $tok_clk_shortVIN$ | rename shortVIN as "$i18n_FGNR$" resultValueDbl as "$i18n_ausfuehrung_in_sek$"</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">90</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">none</option>
      </chart>
      <html>
        <button type="button" id="reset_FGNR_button" class="btn noPrint">$i18n_FGNR_reset$</button>
      </html>
    </panel>
  </row>
</form>