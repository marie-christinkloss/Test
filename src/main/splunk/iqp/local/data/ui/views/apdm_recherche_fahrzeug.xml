<form script="apdm_recherche_fahrzeug/js/apdm_recherche_fahrzeug.js" stylesheet="apdm_recherche_fahrzeug/css/apdm_recherche_fahrzeug.css">
  <init>
    <set token="i18n_Pruefumfang" i18ntag="">Pruefumfang</set>
    <set token="i18n_Fehleranzahl" i18ntag="">Fehleranzahl</set>
    <set token="i18n_FGNR" i18ntag="">FGNR</set>
    <set token="i18n_Test_Zeit" i18ntag="">Test Zeit</set>
    <set token="i18n_Test_System" i18ntag="">Test System</set>
    <set token="i18n_Test_Stand" i18ntag="">Pruefstand</set>
    <set token="i18n_Version" i18ntag="">Version</set>
    <set token="i18n_Komplett" i18ntag="">Komplett</set>
    <set token="i18n_Test_Dauer" i18ntag="">Test Dauer</set>
    <set token="i18n_Details_zu_Pruefumfang" i18ntag="">Details zu Pruefumfang</set>
    <set token="i18n_sequenceNrResult" i18ntag="">SeqNr</set>
    <set token="i18n_testStepName" i18ntag="">Testschrittname</set>
    <set token="i18n_description" i18ntag="">Beschreibung</set>
    <set token="i18n_param1" i18ntag="">SGBD</set>
    <set token="i18n_param2" i18ntag="">Api-Job</set>
    <set token="i18n_param3" i18ntag="">Parameter Api-Job</set>
    <set token="i18n_testStepResult" i18ntag="">Ergebnis</set>
    <set token="i18n_errorText" i18ntag="">Fehlertext</set>
    <set token="i18n_adviseText" i18ntag="">Hinweistext</set>
    <set token="i18n_resultName" i18ntag="">Ergebnisname (Api-Result)</set>
    <set token="i18n_resultValue" i18ntag="">Ergebniswert</set>
    <set token="i18n_Baureihe" i18ntag="">Baureihe</set>
    <set token="i18n_Typschluessel" i18ntag="">Typschluessel</set>
    <set token="i18n_Sistufenr" i18ntag="">Sistufenr</set>
    <set token="i18n_Nacharbeitsdatum" i18ntag="">Nacharbeitsdatum</set>
    <set token="i18n_Merkmal_Bezeichnung" i18ntag="">Merkmal</set>
    <set token="i18n_NA_Fehlerort_Bzg" i18ntag="">NA Fehlerort</set>
    <set token="i18n_NA_Fehlerart_Bzg" i18ntag="">NA Fehlerart</set>
    <set token="i18n_NA_Fehlerlage_Bzg" i18ntag="">NA Fehlerlage</set>
    <set token="i18n_NA_Taetigkeit_Bzg" i18ntag="">NA Taetigkeit</set>
    <set token="i18n_NA_Bemerkung" i18ntag="">NA Bemerkung</set>
    <set token="i18n_NA_Nacharbeiter_ID" i18ntag="">NA Nacharbeiter ID</set>
    <set token="i18n_NA_Schicht_Bzg" i18ntag="">NA Schicht</set>
    <set token="i18n_NA_Leist_KS" i18ntag="">NA Leist Kostenstelle Nr</set>
    <set token="i18n_NA_Leist_MB" i18ntag="">NA Leist Meisterbereich Nr</set>
    <set token="i18n_NA_Bel_KS" i18ntag="">NA Bel Kostenstelle Nr</set>
    <set token="i18n_NA_Bel_MB_Nr" i18ntag="">NA Bel Meisterbereich Nr</set>
    <set token="i18n_NA_Bel_KS_Nr" i18ntag="">NA Bel Produktionsbereich Nr</set>
    <set token="i18n_NA_Dauer" i18ntag="">NA Nacharbeitsdauer</set>
    <set token="i18n_PR_NA_Fehlertyp_Bzg" i18ntag="">PR/NA Fehlertyp</set>
    <set token="i18n_PR_FP_Teil_1" i18ntag="">PR Fehlerprotokoll Teil 1</set>
    <set token="i18n_PR_FP_Teil_2" i18ntag="">PR Fehlerprotokoll Teil 2</set>
    <set token="i18n_PR_FP_Teil_3" i18ntag="">PR Fehlerprotokoll Teil 3</set>
    <set token="i18n_PR_FP_Teil_4" i18ntag="">PR Fehlerprotokoll Teil 4</set>
    <set token="i18n_PR_Station_Nr" i18ntag="">PR Station Nr</set>
    <set token="i18n_NA_Station_Bzg" i18ntag="">NA Station</set>
    <set token="i18n_PR_Pruef_Nacharbeit_BI" i18ntag="">PR Pruef Nacharbeit BI</set>
    <set token="i18n_PR_Bemerkung" i18ntag="">PR Bemerkung</set>
    <set token="i18n_PR_Pruefer_ID" i18ntag="">PR Pruefer ID</set>
    <set token="i18n_Pruefdatum" i18ntag="">Pruefdatum</set>
    <set token="i18n_F1_Datum" i18ntag="">F1 Datum</set> 
  </init>
  <label>APDM Recherche - Fahrzeug</label>
  <description></description>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="tsdatum" searchWhenChanged="true">
      <label>Zeitraum</label>
      <default>
        <earliest>-7d@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="text" token="shortVIN" searchWhenChanged="true">
      <label>FGNR</label>
      <search>
        <query>| tstats values("TestResult.shortVIN") AS shortVIN 
  from datamodel=APDM_TestResults
  where (nodename = TestResult) (TestResult.werk="$werkfilter$")
    $systemName$ $testStand$ $pruefumfangName$ $errorCount$ $complete$ $testDuration$
| mvexpand shortVIN</query>
        <earliest>$tsdatum.earliest$</earliest>
        <latest>$tsdatum.latest$</latest>
      </search>
      <fieldForLabel>shortVIN</fieldForLabel>
      <fieldForValue>shortVIN</fieldForValue>
    </input>
    <input type="dropdown" token="werkfilter" searchWhenChanged="true" id="werkinput">
      <label>Werk</label>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Fehler aus APDM insgesamt</title>
      <single>
        <search base="error_tests">
          <query>stats sum("$i18n_Fehleranzahl$") as "$i18n_Fehleranzahl$"</query>
        </search>
        <drilldown>
          <set token="form.errorCount">0</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <title>Prüfumfänge mit Fehlern</title>
      <table id="element_pruefumfaenge">
        <search id="error_tests">
          <query>| tstats sum("TestResult.errorCount") AS "Fehleranzahl"
  from datamodel=APDM_TestResults
  where (nodename = TestResult) (TestResult.werk="$werkfilter$") (TestResult.shortVIN=$shortVIN$) ("TestResult.errorCount"&gt;0)
  groupby "TestResult.pruefumfangName"
| sort "Fehleranzahl" desc
| rename 
  "TestResult.pruefumfangName" AS "$i18n_Pruefumfang$"
  "Fehleranzahl" AS "$i18n_Fehleranzahl$"</query>
          <earliest>$tsdatum.earliest$</earliest>
          <latest>$tsdatum.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="drilldown">none</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
        <!--<drilldown>
          <set token="pruefumfangName">$row.Prüfumfang$</set>
          <set token="form.pruefumfangName">$row.Prüfumfang$</set>
        </drilldown>-->
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Durchgeführte Prüfungen</title>
      <input type="multiselect" token="systemName" searchWhenChanged="true" id="input_systemName">
        <label>Systemname</label>
        <choice value="*">Alle</choice>
        <search>
          <query>| tstats values("TestResult.systemName") AS systemName 
  from datamodel=APDM_TestResults
  where (nodename = TestResult) (TestResult.werk="$werkfilter$")
    (TestResult.shortVIN=$shortVIN$) $testStand$ $pruefumfangName$ $errorCount$ $complete$ $testDuration$
| mvexpand systemName</query>
          <earliest>$tsdatum.earliest$</earliest>
          <latest>$tsdatum.latest$</latest>
        </search>
        <fieldForLabel>systemName</fieldForLabel>
        <fieldForValue>systemName</fieldForValue>
        <prefix>(</prefix>
        <suffix>)</suffix>
        <valuePrefix>(TestResult.systemName="</valuePrefix>
        <valueSuffix>")</valueSuffix>
        <delimiter> OR </delimiter>
      </input>
      <input type="multiselect" token="testStand" searchWhenChanged="true" id="input_testStand">
        <label>Teststand</label>
        <choice value="*">Alle</choice>
        <search>
          <query>| tstats values("TestResult.testStand") AS testStand 
  from datamodel=APDM_TestResults
  where (nodename = TestResult) (TestResult.werk="$werkfilter$")
    (TestResult.shortVIN=$shortVIN$) $systemName$ $pruefumfangName$ $errorCount$ $complete$ $testDuration$
| mvexpand testStand</query>
          <earliest>$tsdatum.earliest$</earliest>
          <latest>$tsdatum.latest$</latest>
        </search>
        <fieldForLabel>testStand</fieldForLabel>
        <fieldForValue>testStand</fieldForValue>
        <prefix>(</prefix>
        <suffix>)</suffix>
        <valuePrefix>(TestResult.testStand="</valuePrefix>
        <valueSuffix>")</valueSuffix>
        <delimiter> OR </delimiter>
      </input>
      <input type="multiselect" token="pruefumfangName" searchWhenChanged="true" id="input_pruefumfangName">
        <label>Prüfumfang</label>
        <choice value="*">Alle</choice>
        <search>
          <query>| tstats values("TestResult.pruefumfangName") AS pruefumfangName 
  from datamodel=APDM_TestResults
  where (nodename = TestResult) (TestResult.werk="$werkfilter$")
    (TestResult.shortVIN=$shortVIN$) $testStand$ $systemName$ $errorCount$ $complete$ $testDuration$
| mvexpand pruefumfangName</query>
          <earliest>$tsdatum.earliest$</earliest>
          <latest>$tsdatum.latest$</latest>
        </search>
        <fieldForLabel>pruefumfangName</fieldForLabel>
        <fieldForValue>pruefumfangName</fieldForValue>
        <prefix>(</prefix>
        <suffix>)</suffix>
        <valuePrefix>(TestResult.pruefumfangName="</valuePrefix>
        <valueSuffix>")</valueSuffix>
        <delimiter> OR </delimiter>
      </input>
      <input type="checkbox" token="complete" searchWhenChanged="true" id="input_complete">
        <label>Prüfumfang komplett</label>
        <choice value="true">ja</choice>
        <choice value="false">nein</choice>
        <prefix>(</prefix>
        <suffix>)</suffix>
        <valuePrefix>(TestResult.complete="</valuePrefix>
        <valueSuffix>")</valueSuffix>
        <delimiter> OR </delimiter>
      </input>
      <input type="text" token="errorCount" searchWhenChanged="true" id="input_errorCount">
        <label>Anzahl der Fehler größer als</label>
        <prefix>(TestResult.errorCount&gt;</prefix>
        <suffix>)</suffix>
      </input>
      <input type="text" token="testDuration" searchWhenChanged="true" id="input_testDuration">
        <label>Testdauer größer als</label>
        <prefix>(TestResult.testDuration&gt;</prefix>
        <suffix>)</suffix>
      </input>
      <table id="tbl_pruefungen">
        <search id="search_pruefungen">
          <query>| tstats
    values("TestResult.shortVIN") AS "$i18n_FGNR$"
    first("TestResult.testTime") AS "$i18n_Test_Zeit$"
    values("TestResult.systemName") AS "$i18n_Test_System$"
    values("TestResult.testStand") AS "$i18n_Test_Stand$"
    values("TestResult.pruefumfangName") AS "$i18n_Pruefumfang$"
    values("TestResult.testVersion") AS "$i18n_Version$"
    values("TestResult.errorCount") AS "$i18n_Fehleranzahl$"
    values("TestResult.complete") AS "$i18n_Komplett$"
    values("TestResult.testDuration") AS "$i18n_Test_Dauer$"
  from datamodel=APDM_TestResults
  where (nodename = TestResult) (TestResult.werk="$werkfilter$") (TestResult.shortVIN=$shortVIN$) $systemName$ $testStand$ $pruefumfangName$ $errorCount$ $complete$ $testDuration$
  groupby source
| eval source=replace(source,"\\\\","\\\\\\\\")
| eval Komplett=if(Komplett="true","ja",if(Komplett="false","nein",null())) 
| sort "Test Zeit"
| fields * source
| table "$i18n_FGNR$" "$i18n_Test_Zeit$" "$i18n_Test_System$" "$i18n_Test_Stand$" "$i18n_Pruefumfang$" "$i18n_Version$" "$i18n_Fehleranzahl$" "$i18n_Komplett$" "$i18n_Test_Dauer$" source
</query>
          <earliest>$tsdatum.earliest$</earliest>
          <latest>$tsdatum.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="drilldown">row</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">20</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$source$">
      <title>$i18n_Details_zu_Pruefumfang$ $pruefumfangName_det$ ($testTime_det$)</title>
      <input type="dropdown" token="testStepName" searchWhenChanged="true">
        <label>Testschrittname</label>
        <search>
          <query>index=apdm sourcetype=apdm_test_step_result source="$source$" (werk="$werkfilter$") $testStepResult$ $keywords$ | dedup testStepName | eval value="testStepName=\""+testStepName+"\"" | table testStepName value</query>
          <earliest>$tsdatum.earliest$</earliest>
          <latest>$tsdatum.latest$</latest>
        </search>
        <fieldForLabel>testStepName</fieldForLabel>
        <fieldForValue>value</fieldForValue>
        <default></default>
        <choice value=" ">Alle</choice>
      </input>
      <input type="dropdown" token="testStepResult" searchWhenChanged="true">
        <label>Ergebnis des Tests</label>
        <default></default>
        <choice value=" ">Alle</choice>
        <choice value="testStepResult=&quot;OK&quot;">OK</choice>
        <choice value="testStepResult=&quot;NOK&quot;">NOK</choice>
      </input>
      <input type="text" token="keywords" searchWhenChanged="true" id="input_keywords">
        <label>weitere Stichworte</label>
      </input>
      <table>
        <title>Testschritt-Tabelle</title>
        <search>
          <query>index=apdm sourcetype=apdm_test_step_result source="$source$" (werk="$werkfilter$") $testStepResult$ $testStepName$ $keywords$ 
| sort sequenceNrResult 
| table 
    sequenceNrResult testStepName description param1 param2 param3 testStepResult errorText adviseText  resultName resultValueStr resultValueDbl
| eval resultValue=coalesce(resultValueStr,resultValueDbl) | fields - resultValueStr resultValueDbl
| rename
  sequenceNrResult AS "$i18n_sequenceNrResult$"
  testStepName AS "$i18n_testStepName$"
  description AS "$i18n_description$"
  param1 AS "$i18n_param1$"
  param2 AS "$i18n_param2$"
  param3 AS "$i18n_param3$"
  testStepResult AS "$i18n_testStepResult$"
  errorText AS "$i18n_errorText$"
  adviseText AS "$i18n_adviseText$"
  resultName AS "$i18n_resultName$"
  resultValue AS "$i18n_resultValue$"</query>
          <earliest>$tsdatum.earliest$</earliest>
          <latest>$tsdatum.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="drilldown">none</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">20</option>
      </table>
      <event>
        <title>Ereignisdaten komplett</title>
        <search>
          <query>index=apdm source="$source$" (werk="$werkfilter$") (sourcetype=apdm_test_step_result $testStepResult$ $testStepName$ $keywords$) OR (sourcetype=apdm_test_result)
| reverse</query>
          <earliest>$tsdatum.earliest$</earliest>
          <latest>$tsdatum.latest$</latest>
        </search>
        <option name="list.drilldown">full</option>
        <option name="list.wrap">1</option>
        <option name="maxLines">5</option>
        <option name="raw.drilldown">full</option>
        <option name="rowNumbers">0</option>
        <option name="table.drilldown">all</option>
        <option name="table.wrap">1</option>
        <option name="type">list</option>
        <option name="wrap">true</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
      </event>
    </panel>
  </row>
  <row>
    <panel>
      <title>Durchgeführte Nacharbeiten (IPSQ)</title>
      <table id="tbl_nacharbeiten">
        <search id="search_nacharbeiten">
          <query>tag=ipsq shortVIN=$shortVIN$ (werk="$werkfilter$") 
| table "Fahrgestellnummer","Baureihe Code","Typschluessel Nr","Sistufenr","Nacharbeitsdatum","Merkmal Bezeichnung","NA Fehlerort Bezeichnung","NA Fehlerart Bezeichnung","NA Fehlerlage Bezeichnung","NA Taetigkeit Bezeichnung","NA_Bemerkung","NA Nacharbeiter ID","NA Schicht Bezeichnung","NA Leist Kostenstelle Nr","NA Leist Meisterbereich Nr","NA Bel Kostenstelle Nr","NA Bel Meisterbereich Nr","NA Bel Produktionsbereich Nr","NA Nacharbeitsdauer","PR/NA Fehlertyp Bezeichnung","PR Fehlerprotokoll Teil 1","PR Fehlerprotokoll Teil 2","PR Fehlerprotokoll Teil 3","PR Fehlerprotokoll Teil 4","PR Station Nr","NA Station Bezeichnung","PR Pruef Nacharbeit BI","PR_Bemerkung","PR Pruefer ID","Pruefdatum","F1 Datum" 
| rename 
  "Fahrgestellnummer" AS "$i18n_FGNR$"
  "Baureihe Code" AS "$i18n_Baureihe$"
  "Typschluessel Nr" AS "$i18n_Typschluessel$"
  "Sistufenr" AS "$i18n_Sistufenr$"
  "Nacharbeitsdatum" AS "$i18n_Nacharbeitsdatum$"
  "Merkmal Bezeichnung" AS "$i18n_Merkmal_Bezeichnung$"
  "NA Fehlerort Bezeichnung" AS "$i18n_NA_Fehlerort_Bzg$"
  "NA Fehlerart Bezeichnung" AS "$i18n_NA_Fehlerart_Bzg$"
  "NA Fehlerlage Bezeichnung" AS "$i18n_NA_Fehlerlage_Bzg$"
  "NA Taetigkeit Bezeichnung" AS "$i18n_NA_Taetigkeit_Bzg$"
  "NA_Bemerkung" AS "$i18n_NA_Bemerkung$"
  "NA Nacharbeiter ID" AS "$i18n_NA_Nacharbeiter_ID$"
  "NA Schicht Bezeichnung" AS "$i18n_NA_Schicht_Bzg$"
  "NA Leist Kostenstelle Nr" AS "$i18n_NA_Leist_KS$"
  "NA Leist Meisterbereich Nr" AS "$i18n_NA_Leist_MB$"
  "NA Bel Kostenstelle Nr" AS "$i18n_NA_Bel_KS$"
  "NA Bel Meisterbereich Nr" AS "$i18n_NA_Bel_MB_Nr$"
  "NA Bel Produktionsbereich Nr" AS "$i18n_NA_Bel_KS_Nr$"
  "NA Nacharbeitsdauer" AS "$i18n_NA_Dauer$"
  "PR/NA Fehlertyp Bezeichnung" AS "$i18n_PR_NA_Fehlertyp_Bzg$"
  "PR Fehlerprotokoll Teil 1" AS "$i18n_PR_FP_Teil_1$"
  "PR Fehlerprotokoll Teil 2" AS "$i18n_PR_FP_Teil_2$"
  "PR Fehlerprotokoll Teil 3" AS "$i18n_PR_FP_Teil_3$"
  "PR Fehlerprotokoll Teil 4" AS "$i18n_PR_FP_Teil_4$"
  "PR Station Nr" AS "$i18n_PR_Station_Nr$"
  "NA Station Bezeichnung" AS "$i18n_NA_Station_Bzg$"
  "PR Pruef Nacharbeit BI" AS "$i18n_PR_Pruef_Nacharbeit_BI$"
  "PR_Bemerkung" AS "$i18n_PR_Bemerkung$"
  "PR Pruefer ID" AS "$i18n_PR_Pruefer_ID$"
  "Pruefdatum" AS "$i18n_Pruefdatum$"
  "F1 Datum"  AS "$i18n_F1_Datum$" </query>
          <earliest>$tsdatum.earliest$</earliest>
          <latest>$tsdatum.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="drilldown">none</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">20</option>
      </table>
    </panel>
  </row>
</form>