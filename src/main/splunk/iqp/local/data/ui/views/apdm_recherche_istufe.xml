<form script="apdm_recherche_istufe/js/apdm_recherche_istufe.js">
  <init>
    <set token="i18n_Baureihe" i18ntag="">Baureihe</set>
    <set token="i18n_I_Stufe" i18ntag="">I-Stufe</set>
    <set token="i18n_TestStepResult" i18ntag="">TestStepResult</set>
    <set token="i18n_Anzahl_TestStepResults" i18ntag="">Anzahl TestStepResults</set>
    <set token="i18n_Anzahl_Fahrzeuge" i18ntag="">Anzahl Fahrzeuge</set>
    <set token="i18n_FGNR" i18ntag="">FGNR</set>
  </init>
  <label>APDM Recherche - I-Stufe</label>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="time" searchWhenChanged="true">
      <label>Zeitraum (&lt;1 Woche)</label>
      <default>
        <earliest>-7d@d</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="multiselect" token="baureihe" searchWhenChanged="true">
      <label>Baureihe</label>
      <search>
        <query>| tstats values("OrderData.series") AS series from datamodel=APDM_OrderData_Events where (nodename=OrderData) (OrderData.werk="$werkfilter$") (earliest="$order_data_base_search_earliest$") (latest="$order_data_base_search_latest$") | mvexpand series</query>
        <earliest>0</earliest>
      </search>
      <fieldForLabel>series</fieldForLabel>
      <fieldForValue>series</fieldForValue>
      <choice value="*">Alle</choice>
      <default>*</default>
      <valuePrefix>OrderData.series="</valuePrefix>
      <delimiter> OR </delimiter>
      <valueSuffix>"</valueSuffix>
    </input>
    <input type="dropdown" token="i_stufe" searchWhenChanged="true">
      <label>I-Stufe</label>
      <choice value="*">Alle</choice>
      <search>
        <query>| tstats values("OrderData.integrationLevel") AS integrationLevel from datamodel=APDM_OrderData_Events where (nodename=OrderData) (OrderData.werk="$werkfilter$") (earliest="$order_data_base_search_earliest$") (latest="$order_data_base_search_latest$") | mvexpand integrationLevel</query>
      </search>
      <fieldForLabel>integrationLevel</fieldForLabel>
      <fieldForValue>integrationLevel</fieldForValue>
      <default>*</default>
      <prefix>OrderData.integrationLevel="</prefix>
      <suffix>"</suffix>
    </input>
    <input type="dropdown" token="tsr" searchWhenChanged="true">
      <label>Test-Step-Result</label>
      <choice value="*">Alle</choice>
      <choice value="NOK">NOK</choice>
      <choice value="OK">OK</choice>
      <default>*</default>
    </input>
    <input type="dropdown" token="werkfilter" searchWhenChanged="true" id="werkinput">
      <label>Werk</label>
    </input>
  </fieldset>
  <row>
    <panel>
      <table id="tbl_rech_istufe">
        <search id="search_rech_istufe">
          <query>| pivot APDM_TestStepResults TestStepResult count(TestStepResult) AS count  SPLITROW shortVIN SPLITROW testStepResult  FILTER testStepResult is "$tsr$" FILTER werk is "$werkfilter$" | search testStepResult=OK OR testStepResult=NOK | join shortVIN [

| loadjob $order_data_base_search_sid$

 ] 
| stats 
    sum(count) as cnt_teststepRes 
    distinct_count(shortVIN) as cnt_vehicle 
    values(shortVIN) as y 
  by baureihe integrationLevel testStepResult 
| eval shortVINs=if(cnt_vehicle&lt;10,y,null) 
| fields - y 
| rename 
  baureihe AS "$i18n_Baureihe$"
  integrationLevel AS "$i18n_I_Stufe$"
  testStepResult AS "$i18n_TestStepResult$"
  cnt_teststepRes AS "$i18n_Anzahl_TestStepResults$"
  cnt_vehicle AS "$i18n_Anzahl_Fahrzeuge$"
  shortVINs AS "$i18n_FGNR$"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</form>