<form stylesheet="tabs/css/tabs.css" script="tabs/js/tabs.js, DTC/js/db_uebersicht.js">
  <init>
    <set token="i18n_Fahrzeug_Analyse" i18ntag="">Fahrzeug Analyse</set>
    <set token="i18n_DTC_Analyse" i18ntag="">DTC Analyse</set>
    <set token="i18n_Fahrzeugauswahl" i18ntag="">Fahrzeugauswahl</set>
    <set token="i18n_werk" i18ntag="">Werk</set>
    <set token="i18n_shortVIN" i18ntag="">FGNR</set>
    <set token="i18n_series" i18ntag="">Baureihe</set>
    <set token="i18n_vehicleType" i18ntag="">Fahrzeugtyp</set>
    <set token="i18n_integrationLevel" i18ntag="">I-Stufe</set>
    <set token="i18n_countryVariant" i18ntag="">Ländervariante</set>
    <set token="i18n_driveType" i18ntag="">LL/RL</set>
    <set token="i18n_F2" i18ntag="">F2-Datum</set>
    <set token="i18n_engineSeries" i18ntag="">Motorbaureihe</set>
    <set token="i18n_gearboxType" i18ntag="">Getriebe</set>
    <set token="i18n_typeKey" i18ntag="">Typschluessel</set>
    <set token="i18n_timeCriteria" i18ntag="">Zeitkriterium</set>
    <set token="i18n_driveConfiguration" i18ntag="">DriveKonfig</set>
    <set token="i18n_hybridType" i18ntag="">Hybrid</set>
    <set token="i18n_saCode" i18ntag="">Code</set>
    <set token="i18n_DESCRIPTIONDE" i18ntag="">Beschreibung</set>
    <set token="i18n_engineFamily" i18ntag="">Motorfamilie</set>
    <set token="i18n_engineSeries" i18ntag="">Motorbaureihe</set>
    <set token="i18n_engineDerivative" i18ntag="">Derivat</set>
    <set token="i18n_dtcCode" i18ntag="">DTC-Code</set>
    <set token="i18n_dtcSGBD" i18ntag="">SGBD</set>
    <set token="i18n_dtcText" i18ntag="">Fehlertext</set>
    <set token="i18n_AnzahlFzg" i18ntag="">Anzahl Fahrzeuge</set>
    <set token="i18n_Auswertung" i18ntag="">Auswertung</set>
    <set token="i18n_Tabelle" i18ntag="">Tabelle</set>
    <set token="i18n_Tortendiagramm" i18ntag="">Tortendiagramm</set>
    <set token="table_vehicle_selection_count">-</set>
    <set token="table_dtc_selection_count">-</set>
    <set token="form.filt_dtc">/</set>
  </init>
  <label>D2 - APDM DTC-Analyse (Ceasar in Splunk)</label>
  <search id="base_search_filters">
    <query>
      <![CDATA[
| tstats 
    values(OrderData.integrationLevel) as integrationLevel
    values(OrderData.series) as series
    values(OrderData.countryVariant) as countryVariant
    values(OrderData.saCode) as saCode
  from datamodel=APDM_OrderData_Events
  where (nodename = OrderData) OrderData.werk IN $default:werkfilter$
| appendcols [ tstats values(DTCEntry.dtcCode) as dtcCode from datamodel=APDM_DTC where (nodename = DTCEntry) DTCEntry.werk IN $default:werkfilter$ NOT (DTCEntry.dtcCode="-") summariesonly=true ]
        ]]>
      </query>
    <earliest>$default:TimeRangeFilter.earliest$</earliest>
    <latest>$default:TimeRangeFilter.latest$</latest>
  </search>
  <search id="search_vehicle_tabdata">
    <query>
      <![CDATA[
| tstats summariesonly=true 
      values(OrderData.werk) as werk
      values(OrderData.series) as series            
      values(OrderData.vehicleType) as vehicleType       
      values(OrderData.integrationLevel) as integrationLevel  
      values(OrderData.countryVariant) as countryVariant    
      values(OrderData.driveType) as driveType         
      values(OrderData.engineSeries) as engineSeries      
      values(OrderData.gearboxType) as gearboxType       
      values(OrderData.typeKey) as typeKey           
      values(OrderData.timeCriteria) as timeCriteria      
      values(OrderData.driveConfiguration) as driveConfiguration
      values(OrderData.hybridType) as hybridType        
      values(OrderData.saCode) as saCode
      values(OrderData.engineFamily) as engineFamily      
      values(OrderData.engineDerivative) as engineDerivative  
    from datamodel=APDM_OrderData_Events 
    where (nodename = OrderData) OrderData.werk IN $werkfilter$ OrderData.shortVIN IN $shortvin$ OrderData.integrationLevel IN $integrationLevel$ OrderData.series IN $series$ OrderData.saCode IN $saCode$ OrderData.countryVariant IN $countryVariant$ [ makeresults | addinfo | eval earliest=info_min_time-14*24*60*60 | eval earliest=if(earliest>0,earliest,0) | eval latest=info_max_time | table earliest latest | format "(" "" "" "" "" ")"]
    groupby OrderData.shortVIN
| rename OrderData.* as * 

| join shortVIN type=outer
[ tstats summariesonly=true
      count
    from datamodel=APDM_DTC
    where (nodename = DTCEntry) DTCEntry.werk IN $werkfilter$ DTCEntry.shortVIN IN $shortvin$ DTCEntry.integrationLevel IN $integrationLevel$ DTCEntry.series IN $series$ DTCEntry.saCode IN $saCode$ DTCEntry.dtcSGBD IN $dtcSGBD$ DTCEntry.dtcCode IN $dtcCode$
    groupby DTCEntry.shortVIN
| rename DTCEntry.* as * 
]
| search count>0
| fillnull value="" F2 

      ]]>
    </query>
    <earliest>$TimeRangeFilter.earliest$</earliest>
    <latest>$TimeRangeFilter.latest$</latest>
  </search>
  <fieldset submitButton="true" autorun="false">
    <input type="multiselect" id="werkinput" searchWhenChanged="false" token="werkfilter">
      <label>Werk</label>
      <valuePrefix>"</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <delimiter>, </delimiter>
    </input>
    <input type="time" token="TimeRangeFilter">
      <label>Zeitspanne</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="multiselect" id="shortvininput" searchWhenChanged="false" token="shortvin">
      <label>FGNR</label>
      <default>*</default>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>"</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter>, </delimiter>
      <choice value="*">Alle</choice>
      <allowCustomValues>true</allowCustomValues>
      <fieldForLabel>shortVIN</fieldForLabel>
      <fieldForValue>shortVIN</fieldForValue>
    </input>
    <input type="multiselect" id="countryVariantinput" searchWhenChanged="false" token="countryVariant">
      <label>Ländervariante</label>
      <default>*</default>
      <search base="base_search_filters">
        <query>| fields countryVariant | mvexpand countryVariant | dedup countryVariant</query>
      </search>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>"</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter>, </delimiter>
      <choice value="*">Alle</choice>
      <allowCustomValues>true</allowCustomValues>
      <fieldForLabel>countryVariant</fieldForLabel>
      <fieldForValue>countryVariant</fieldForValue>
    </input>
    <input type="multiselect" id="ilevelinput" searchWhenChanged="false" token="integrationLevel">
      <label>I-Stufe</label>
      <search base="base_search_filters">
        <query>| fields integrationLevel | mvexpand integrationLevel | dedup integrationLevel</query>
      </search>
      <default>*</default>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>"</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter>, </delimiter>
      <choice value="*">Alle</choice>
      <allowCustomValues>true</allowCustomValues>
      <fieldForLabel>integrationLevel</fieldForLabel>
      <fieldForValue>integrationLevel</fieldForValue>
    </input>
    <input type="multiselect" id="seriesinput" searchWhenChanged="false" token="series">
      <label>Baureihe</label>
      <search base="base_search_filters">
        <query>| fields series | mvexpand series | dedup series</query>
      </search>
      <default>*</default>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>"</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter>, </delimiter>
      <choice value="*">Alle</choice>
      <allowCustomValues>true</allowCustomValues>
      <fieldForLabel>series</fieldForLabel>
      <fieldForValue>series</fieldForValue>
    </input>
    <input type="multiselect" id="sacodeinput" searchWhenChanged="false" token="saCode">
      <label>Sonderausstattung(en)</label>
      <default>*</default>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>"</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter>, </delimiter>
      <choice value="*">Alle</choice>
      <allowCustomValues>true</allowCustomValues>
      <fieldForLabel>saCode</fieldForLabel>
    </input>
    <input type="multiselect" id="sgbdinput" searchWhenChanged="false" token="dtcSGBD">
      <label>SGBD</label>
      <search id="base_search_filters_sgbd" base="base_search_filters">
        <query>
      <![CDATA[
| table dtcCode
| mvexpand dtcCode
| lookup dtc_translation DTC_CODE_HEX as dtcCode output SGBD
| mvexpand SGBD
| table SGBD | dedup SGBD
        ]]>
        </query>
      </search>
      <default>*</default>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>"</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter>, </delimiter>
      <choice value="*">Alle</choice>
      <allowCustomValues>true</allowCustomValues>
      <fieldForLabel>SGBD</fieldForLabel>
      <fieldForValue>SGBD</fieldForValue>
    </input>
    <input type="multiselect" id="dtcinput" searchWhenChanged="false" token="dtcCode">
      <search base="base_search_filters">
        <query>
| fields dtcCode | mvexpand dtcCode 
| lookup dtc_translation DTC_CODE_HEX as dtcCode output SGBD
| search SGBD IN $default:dtcSGBD$ | fields dtcCode | dedup dtcCode</query>
      </search>
      <label>DTC-Code</label>
      <default>*</default>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>"</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter>, </delimiter>
      <choice value="*">Alle</choice>
      <allowCustomValues>true</allowCustomValues>
      <fieldForLabel>dtcCode</fieldForLabel>
      <fieldForValue>dtcCode</fieldForValue>
    </input>
  </fieldset>
  <row id="tabs">
    <panel>
      <html>
				<ul class="nav nav-tabs" id="tabs">
					<li class="active">
						<a href="#" class="toggle-tab" data-token="tab1_clicked" data-elements="Analyse_fahrzeug,compareRow,compareRow2" data-toggle="tab">$i18n_Fahrzeug_Analyse$</a>
					</li>
					<li>
						<a href="#" class="toggle-tab" data-token="tab2_clicked" data-elements="Analyse_dtc0,Analyse_dtc_fieldset,Analyse_dtc1,Analyse_dtc2,Analyse_dtc3" data-toggle="tab">$i18n_DTC_Analyse$</a>
					</li>
				</ul>
	  </html>
    </panel>
  </row>
  <row id="Analyse_fahrzeug">
    <panel>
      <table id="table_vehicle_selection">
        <title>$i18n_Fahrzeugauswahl$ ($table_vehicle_selection_count$)</title>
        <search id="vehicalSelection" base="search_vehicle_tabdata">
          <query> 
            <![CDATA[
| table werk shortVIN series vehicleType integrationLevel countryVariant driveType F2 engineSeries gearboxType typeKey timeCriteria driveConfiguration hybridType
| lookup lkup_werk_input value as werk OUTPUT werk
| eval " "=shortVIN
| rename 
  werk AS "$i18n_werk$"
  shortVIN AS "$i18n_shortVIN$"
  series AS "$i18n_series$"
  vehicleType AS "$i18n_vehicleType$"
  integrationLevel AS "$i18n_integrationLevel$"
  countryVariant AS "$i18n_countryVariant$"
  driveType AS "$i18n_driveType$"
  F2 AS "$i18n_F2$"
  engineSeries AS "$i18n_engineSeries$"
  gearboxType AS "$i18n_gearboxType$"
  typeKey AS "$i18n_typeKey$"
  timeCriteria AS "$i18n_timeCriteria$"
  driveConfiguration AS "$i18n_driveConfiguration$"
  hybridType AS "$i18n_hybridType$"

            ]]>
          </query>
          <done>
            <set token="table_vehicle_selection_count">$job.resultCount$</set>
          </done>
        </search>
        <option name="rowNumbers">false</option>
        <option name="drilldown">row</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">20</option>
      </table>
    </panel>
  </row>
  <row id="compareRow">
    <panel>
      <title>Schnittmenge</title>
      <input type="multiselect" id="input_filt_shortVIN" token="filt_shortVIN">
        <label>FGNR</label>
        <delimiter> OR </delimiter>
        <prefix>(</prefix>
        <suffix>)</suffix>
        <allowCustomValues>true</allowCustomValues>
        <valuePrefix>shortVIN="</valuePrefix>
        <valueSuffix>"</valueSuffix>
        <choice value="*">Alle</choice>
      </input>
    </panel>
  </row>
  <row id="compareRow2">
    <panel>
      <table id="saTable">
        <title>Sonderausstattung(en)</title>
        <search base="search_vehicle_tabdata">
          <query>
            <![CDATA[
  search $default:filt_shortVIN$
| eventstats dc(shortVIN) as total
| stats 
  count
  by saCode total
| where count=total | fields - count total
| lookup sa_translation CODE as saCode OUTPUTNEW DESCRIPTIONDE
| rename 
  saCode AS "$i18n_saCode$"
  DESCRIPTIONDE AS "$i18n_DESCRIPTIONDE$"
            ]]>
          </query>
        </search>
      </table>
    </panel>
    <panel>
      <table id="engineTable">
        <title>Motoren(en)</title>
        <search base="search_vehicle_tabdata">
          <query>
            <![CDATA[
  search $default:filt_shortVIN$
| eventstats dc(shortVIN) as total
| stats 
  count
  by engineFamily engineSeries engineDerivative total
| where count=total | fields - count total 
| rename 
  engineFamily AS "$i18n_engineFamily$"
  engineSeries AS "$i18n_engineSeries$"
  engineDerivative AS "$i18n_engineDerivative$"
            ]]>
          </query>
        </search>
      </table>
    </panel>
    <panel>
      <table id="dtcTable">
        <title>DTC-Code</title>
        <search>
          <query>
            <![CDATA[
| tstats count
FROM datamodel=APDM_DTC
WHERE DTCEntry.countryVariant IN $countryVariant$ DTCEntry.werk IN $werkfilter$ DTCEntry.integrationLevel IN $integrationLevel$ DTCEntry.series IN $series$ DTCEntry.saCode IN $saCode$
BY DTCEntry.shortVIN, DTCEntry.dtcCode, DTCEntry.dtcSGBD, DTCEntry.dtcText
| rename DTCEntry.* AS *
| search $default:filt_shortVIN$
| fields dtcCode dtcSGBD dtcText shortVIN total | dedup dtcCode dtcSGBD dtcText shortVIN
| eventstats
    dc(shortVIN) as total
| stats 
  count
  by dtcCode dtcSGBD dtcText total
| where count=total | fields - count total 
| rename
  dtcCode AS "DTC-Code"
  dtcSGBD AS "$i18n_dtcSGBD$"
  dtcText AS "$i18n_dtcText$"
            ]]>
          </query>
          <earliest>$TimeRangeFilter.earliest$</earliest>
          <latest>$TimeRangeFilter.latest$</latest>
        </search>
      </table>
    </panel>
  </row>
  <row id="Analyse_dtc1">
    <panel>
      <table id="table_dtc_selection">
        <title>DTC-Code  ($table_dtc_selection_count$)</title>
        <search id="search_dtc_tabdata">
          <query>
      <![CDATA[ 
| tstats dc(DTCEntry.shortVIN) AS "$i18n_AnzahlFzg$"
    FROM datamodel=APDM_DTC
    WHERE DTCEntry.countryVariant IN $countryVariant$ DTCEntry.werk IN $werkfilter$ DTCEntry.shortVIN IN $shortvin$ DTCEntry.integrationLevel IN $integrationLevel$ DTCEntry.series IN $series$ DTCEntry.saCode IN $saCode$ DTCEntry.dtcSGBD IN $dtcSGBD$ DTCEntry.dtcCode IN $dtcCode$
    BY DTCEntry.dtcCode, DTCEntry.dtcSGBD, DTCEntry.dtcText
| rename DTCEntry.* AS *
| eval " "=dtcCode 
| rename 
  dtcCode AS "DTC-Code"
  dtcSGBD AS "$i18n_dtcSGBD$"
  dtcText AS "$i18n_dtcText$" 
    ]]>
          </query>
          <earliest>$TimeRangeFilter.earliest$</earliest>
          <latest>$TimeRangeFilter.latest$</latest>
          <done>
            <set token="table_dtc_selection_count">$job.resultCount$</set>
          </done>
        </search>
        <option name="rowNumbers">false</option>
        <option name="drilldown">row</option>
        <drilldown>
          <set token="form.filt_dtc">$row.DTC-Code$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row id="Analyse_dtc_fieldset">
    <panel>
      <title>$i18n_Auswertung$ ($form.filt_dtc$)</title>
      <input type="dropdown" id="input_filt_dtc" token="filt_dtc">
        <label>DTC-Code</label>
        <allowCustomValues>true</allowCustomValues>
        <prefix>dtcCode="</prefix>
        <suffix>"</suffix>
      </input>
    </panel>
  </row>
  <row id="Analyse_dtc2">
    <panel>
      <input type="dropdown" token="needed1">
        <label>Auswertung auswaehlen:</label>
        <choice value="link6">Tabelle</choice>
        <choice value="link7">Tortendiagramm</choice>
        <default>link6</default>
        <change>
          <condition value="link6">
            <set token="showTable1">true</set>
            <unset token="showChart1"></unset>
          </condition>
          <condition value="link7">
            <unset token="showTable1"></unset>
            <set token="showChart1">true</set>
          </condition>
        </change>
      </input>
      <table depends="$showTable1$">
        <title>I-Stufe</title>
        <search id="search_dtc_integrationlevel">
          <query>
| tstats dc(DTCEntry.shortVIN) AS "$i18n_AnzahlFzg$"
FROM datamodel=APDM_DTC
WHERE DTCEntry.countryVariant IN $countryVariant$ DTCEntry.werk IN $werkfilter$ DTCEntry.shortVIN IN $shortvin$ DTCEntry.integrationLevel IN $integrationLevel$ DTCEntry.series IN $series$ DTCEntry.saCode IN $saCode$ DTCEntry.dtcCode IN $dtcCode$
BY DTCEntry.integrationLevel, DTCEntry.dtcCode | rename DTCEntry.* AS *
| search $default:filt_dtc$
| rename integrationLevel AS "$i18n_integrationLevel$"
| fields - dtcCode
          </query>
          <earliest>$TimeRangeFilter.earliest$</earliest>
          <latest>$TimeRangeFilter.latest$</latest>
        </search>
        <option name="rowNumbers">false</option>
        <option name="drilldown">row</option>
      </table>
      <chart depends="$showChart1$">
        <title>I-Stufe Tortendiagramm</title>
        <search  base="search_dtc_integrationlevel"></search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
    <panel>
      <input type="dropdown" token="needed2">
        <label>Auswertung auswaehlen:</label>
        <choice value="link4">Tabelle</choice>
        <choice value="link5">Tortendiagramm</choice>
        <default>link4</default>
        <change>
          <condition value="link4">
            <set token="showTable2">true</set>
            <unset token="showChart2"></unset>
          </condition>
          <condition value="link5">
            <unset token="showTable2"></unset>
            <set token="showChart2">true</set>
          </condition>
        </change>
      </input>
      <table depends="$showTable2$">
        <title>Baureihe</title>
        <search id="search_dtc_series">
          <query>
            <![CDATA[
| tstats dc(DTCEntry.shortVIN) AS "$i18n_AnzahlFzg$"
FROM datamodel=APDM_DTC
WHERE DTCEntry.countryVariant IN $countryVariant$ DTCEntry.werk IN $werkfilter$ DTCEntry.shortVIN IN $shortvin$ DTCEntry.integrationLevel IN $integrationLevel$ DTCEntry.series IN $series$ DTCEntry.saCode IN $saCode$ DTCEntry.dtcCode IN $dtcCode$
BY DTCEntry.series, DTCEntry.dtcCode
| rename DTCEntry.* AS *
| search $default:filt_dtc$
| rename series AS "$i18n_series$"
| fields - dtcCode
            ]]>
          </query>
          <earliest>$TimeRangeFilter.earliest$</earliest>
          <latest>$TimeRangeFilter.latest$</latest>
        </search>
        <option name="rowNumbers">false</option>
        <option name="drilldown">row</option>
      </table>
      <chart depends="$showChart2$">
        <title>Baureihe Tortendiagramm</title>
        <search base="search_dtc_series"></search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
  </row>
  <row id="Analyse_dtc3">
    <panel>
      <table>
        <title>Weitere DTCs in den Fahrzeugen</title>
        <search>
          <query>
            <![CDATA[
| tstats count
FROM datamodel=APDM_DTC
WHERE DTCEntry.countryVariant IN $countryVariant$ DTCEntry.werk IN $werkfilter$ DTCEntry.shortVIN IN $shortvin$ DTCEntry.integrationLevel IN $integrationLevel$ DTCEntry.series IN $series$ DTCEntry.saCode IN $saCode$
BY DTCEntry.shortVIN, DTCEntry.dtcCode, DTCEntry.dtcSGBD, DTCEntry.dtcText
| rename DTCEntry.* AS *
| eval has_dtc=if($default:filt_dtc$,1,null())
| eventstats max(has_dtc) as has_dtc by shortVIN
| search has_dtc=1
| stats dc(shortVIN) AS "$i18n_AnzahlFzg$" by dtcCode dtcSGBD dtcText
| sort - "$i18n_AnzahlFzg$"
| rename
    dtcCode AS "DTC-Code"
    dtcSGBD AS "$i18n_dtcSGBD$"
    dtcText AS "$i18n_dtcText$"
            ]]>
          </query>
          <earliest>$TimeRangeFilter.earliest$</earliest>
          <latest>$TimeRangeFilter.latest$</latest>
        </search>
        <option name="rowNumbers">false</option>
        <option name="drilldown">row</option>
      </table>
    </panel>
  </row>
</form>