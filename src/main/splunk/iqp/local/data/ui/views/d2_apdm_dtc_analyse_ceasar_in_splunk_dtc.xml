<form script="DTC/js/db_analyse.js">
  <init>
    <set token="i18n_" i18ntag=""></set>
    <set token="i18n_pruefumfangName" i18ntag="">Pr체fumfang</set>
    <set token="i18n_AnzahlDTC" i18ntag="">Anzahl DTC</set>
    <set token="i18n_shortVIN" i18ntag="">FGNR</set>
    <set token="i18n_series" i18ntag="">Baureihe</set>
    <set token="i18n_vehicleType" i18ntag="">Fahrzeugtyp</set>
    <set token="i18n_integrationLevel" i18ntag="">I-Stufe</set>
    <set token="i18n_countryVariant" i18ntag="">L채ndervariante</set>
    <set token="i18n_driveType" i18ntag="">LL/RL</set>
    <set token="i18n_engineSeries" i18ntag="">Motorbaureihe</set>
    <set token="i18n_gearboxType" i18ntag="">Getriebe</set>
    <set token="i18n_typeKey" i18ntag="">Typschluessel</set>
    <set token="i18n_timeCriteria" i18ntag="">Zeitkriterium</set>
    <set token="i18n_driveConfiguration" i18ntag="">DriveKonfig</set>
    <set token="i18n_hybridType" i18ntag="">Hybrid</set>
    <set token="i18n_saCode" i18ntag="">Code</set>
    <set token="i18n_DESCRIPTIONDE" i18ntag="">Beschreibung</set>
    <set token="i18n_count" i18ntag="">Anzahl</set>
    <set token="i18n_dtcTime" i18ntag="">DTC Zeit</set>
  </init>
  <label>D2.2 - APDM DTC-Analyse (Ceasar in Splunk)/ DTC-Analyse</label>
  <search id="search_dtc_analyse_base">
    <query>
      <![CDATA[
| tstats count
    FROM datamodel=APDM_DTC
    WHERE DTCEntry.countryVariant IN $countryVariant$ DTCEntry.werk IN $werkfilter$ DTCEntry.shortvin IN $shortvin$ DTCEntry.integrationLevel IN $integrationLevel$ DTCEntry.series IN $series$ DTCEntry.saCode IN $saCode$ DTCEntry.dtcCode=$dtc$
    BY DTCEntry.shortVIN, DTCEntry.dtcCode, DTCEntry.dtcSGBD, DTCEntry.dtcText, DTCEntry.pruefumfangName, DTCEntry.testTime, DTCEntry.dtcTime
| rename DTCEntry.* AS *
      ]]>
    </query>
    <earliest>$el$</earliest>
    <latest>$la$</latest>
  </search>
  <search id="search_dtc_pruefumfang_analyse_base" base="search_dtc_analyse_base">
    <query>| search pruefumfangName="$pruefumfangNameClicked$"</query>
    <done>
      <set token="sid">$job.sid$</set>
    </done>
  </search>
  <fieldset submitButton="false">
    <input type="checkbox" token="jitter">
      <label></label>
      <choice value="true">zeige Schwankung</choice>
      <delimiter> </delimiter>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Betroffene Pr체fumf채nge</title>
      <table id="master">
        <search base="search_dtc_analyse_base">
          <query>| stats c(pruefumfangName) AS AnzahlDTC by pruefumfangName 
| table pruefumfangName AnzahlDTC
| rename 
  pruefumfangName AS "$i18n_pruefumfangName$"
  AnzahlDTC AS "$i18n_AnzahlDTC$"
</query>
        </search>
        <option name="drilldown">cell</option>
      </table>
    </panel>
    <panel>
      <title>Tortendiagramm</title>
      <chart id="detail">
        <search base="search_dtc_analyse_base">
          <query>| chart count by pruefumfangName | sort count</query>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <chart depends="$jitter$">
        <title>Jitter</title>
        <search base="search_dtc_pruefumfang_analyse_base">
          <query>chart count AS "$i18n_count$" by dtcTime | rename dtcTime AS "$i18n_dtcTime$"</query>
        </search>
        <option name="charting.chart">column</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <table id="fahrzeuge" depends="$pruefumfangNameClicked$">
        <title>Fahrzeuge</title>
        <search>
          <query>
			<![CDATA[      
| tstats
      values(OrderData.series) AS series            
      values(OrderData.vehicleType) AS vehicleType       
      values(OrderData.integrationLevel) AS integrationLevel  
      values(OrderData.countryVariant) AS countryVariant    
      values(OrderData.driveType) AS driveType         
      values(OrderData.engineSeries) AS engineSeries      
      values(OrderData.gearboxType) AS gearboxType       
      values(OrderData.typeKey) AS typeKey           
      values(OrderData.timeCriteria) AS timeCriteria      
      values(OrderData.driveConfiguration) AS driveConfiguration
      values(OrderData.hybridType) AS hybridType
    from datamodel=APDM_OrderData_Events
    where ( nodename = OrderData ) [ loadjob $sid$ | stats values(shortVIN) as "OrderData.shortVIN" ]
    groupby OrderData.shortVIN summariesonly=true
| rename OrderData.* as * 

| table shortVIN series vehicleType integrationLevel countryVariant driveType engineSeries gearboxType typeKey timeCriteria driveConfiguration hybridType
| rename 
  shortVIN AS "$i18n_shortVIN$"
  series AS "$i18n_series$"
  vehicleType AS "$i18n_vehicleType$"
  integrationLevel AS "$i18n_integrationLevel$"
  countryVariant AS "$i18n_countryVariant$"
  driveType AS "$i18n_driveType$"
  engineSeries AS "$i18n_engineSeries$"
  gearboxType AS "$i18n_gearboxType$"
  typeKey AS "$i18n_typeKey$"
  timeCriteria AS "$i18n_timeCriteria$"
  driveConfiguration AS "$i18n_driveConfiguration$"
  hybridType AS "$i18n_hybridType$"
       
            ]]>
		  </query>
          <done>
            <set token="total_vins">$job.resultCount$</set>
          </done>
        </search>
        <option name="drilldown">row</option>
        <drilldown>
          <link target="_blank">
            <![CDATA[d2_apdm_dtc_analyse_ceasar_in_splunk_fahrzeug?shortVIN=$click.value$&el=$el$&la=$la$&dtcCode=$dtc$]]>
          </link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="saschnittmenge" depends="$pruefumfangNameClicked$">
        <title>Schnittmenge SA</title>
        <search>
          <query>
                                          <![CDATA[
| tstats dc(OrderData.shortVIN) as count
    from datamodel=APDM_OrderData_Events
    where ( nodename = OrderData )
          [ loadjob $sid$ | stats values(shortVIN) as "OrderData.shortVIN" ] 
    groupby OrderData.saCode summariesonly=true
| rename OrderData.* as * 
| search count=$total_vins$ | fields - count
| lookup sa_translation CODE as saCode OUTPUTNEW DESCRIPTIONDE
| rename
  saCode as $i18n_saCode$
  DESCRIPTIONDE as $i18n_DESCRIPTIONDE$
                                          ]]>
					</query>
        </search>
        <option name="drilldown">row</option>
      </table>
    </panel>
  </row>
</form>